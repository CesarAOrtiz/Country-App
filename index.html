<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="A website to display important information about all the countries of the world"
        />
        <link rel="icon" href="favicon/icon.ico" type="favicon" />
        <link rel="stylesheet" href="css/index.css" />
        <title>Country App</title>
    </head>
    <body>
        <header>
            <p id="logo">Countries</p>
            <p id="dark" onclick="changeMode()">Dark Mode</p>
        </header>
        <form>
            <input type="text" placeholder="Search" aria-label="Search field" />
            <img src="icons/lupa.png" width="20" height="20" alt="Search" />
        </form>
        <section>
            <div>
                <div style="opacity: 0">
                    <div></div>
                    <ul>
                        <li>Country</li>
                        <li>Population:</li>
                        <li>Capital:</li>
                        <li>Region:</li>
                    </ul>
                </div>
            </div>
        </section>
        <script>
            window.onload = callAPI;
            window.onresize = gridLayout;

            async function callAPI() {
                try {
                    const response = await fetch(
                        "https://restcountries.eu/rest/v2/all?fields=name;capital;flag;region;population"
                    );
                    const data = await response.json();
                    gridLayout();
                    await show(data);
                } catch (error) {
                    console.log(error);
                }
            }

            async function show(object) {
                html = "";
                object.forEach((element) => {
                    html += `
                <div>
                    <div><img src="${element.flag}" alt="Flag"></div>
                    <ul>
                        <li>${element.name}</li>
                        <li>Capital: ${element.capital}</li>
                        <li>Region: ${element.region}</li>
                        <li>Poblacion: ${element.population}</li>
                    </ul>
                </div>`;
                });
                document.querySelector("section div").innerHTML = html;
            }

            function gridLayout() {
                let sec = document.querySelector("section");
                let grid = document.querySelector("section div");
                let cell = document.querySelector("section div div");
                let cellMargin = parseInt(window.getComputedStyle(cell).margin);
                let num = parseInt(
                    sec.clientWidth / (cell.offsetWidth + cellMargin)
                );
                grid.style.gridTemplateColumns = `repeat(${num}, 1fr)`;
            }

            function changeMode() {
                let body = document.querySelector("body");
                let bg = window.getComputedStyle(body).backgroundColor;
                let colors = body.style;
                colors.setProperty("--pc", "hsl(0, 0%, 55%)");
                if (bg == "rgb(224, 224, 224)") {
                    colors.setProperty("--bgc", "hsl(207, 26%, 17%)");
                    colors.setProperty("--ebg", "hsl(209, 23%, 22%)");
                    colors.setProperty("--lc", "hsl(0, 0%, 100%)");
                }
                if (bg == "rgb(32, 44, 55)") {
                    colors.setProperty("--bgc", "hsl(0, 0%, 88%)");
                    colors.setProperty("--ebg", "hsl(0, 0%, 100%)");
                    colors.setProperty("--lc", "hsl(200, 15%, 8%)");
                }
            }
        </script>
        <script src="js/index.js"></script>
    </body>
</html>
